<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta property="og:title" content="Preventing concurrent GitHub Actions">
<meta property="og:image" content="https://jldec.me/images/rose.jpg">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jldec.me/getting-started-with-go">
<meta property="og:description" content="Use the new concurrency group feature to prevent concurrent GitHub Actions workflow runs">
<meta name="twitter:site" content="@jldec">
<meta name="twitter:creator" content="@jldec">
<meta name="twitter:title" content="Preventing concurrent GitHub Actions">
<meta name="twitter:description" content="Use the new concurrency group feature to prevent concurrent GitHub Actions workflow runs">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:widgets:new-embed-design" content="on">
<meta name="twitter:image" content="https://jldec.me/images/rose.jpg">
<meta name="twitter:image:alt" content="Grape Hyacinths in Cambridge UK">
<meta name="robots" content="noindex, nofollow">
<link rel="canonical" href="https://jldec.me/serializing-github-actions-with-workers-durable-objects">

<!-- html generated by pub-server from markdown /preventing-concurrent-github-actions.md -->

<title>Preventing concurrent GitHub Actions</title>
<link rel="stylesheet" href="./css/pubblog.css">
<link rel="stylesheet" href="./css/open-sans.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<link rel="stylesheet" href="./css/highlight-9.18.1-github.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout">
<header>
<div id="doctitle"><h1 id="jldecuk"><a href="./">jldec.uk</a></h1>
</div>
<div id="topmenu"><div data-render-html="/#topmenu">&nbsp;</div></div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-2x">&#xf01a;</span></p>

<nav id="toc">
<ul>
<li><strong><a href="./">Home</a></strong></li>
<li><a href="./serializing-github-actions-with-workers-durable-objects">Preventing concurrent GitHub Actions</a></li>
<li><a href="./getting-started-with-go-part-3-goroutines-and-channels">Getting started with Goroutines and channels</a></li>
<li><a href="./getting-started-with-go-part-2-pointers">Getting started with Go pointers</a></li>
<li><a href="./getting-started-with-go">Getting started with Go</a></li>
<li><a href="./extracting-an-esm-module-from-a-deno-script">Extracting an ESM module from a Deno script</a></li>
<li><a href="./running-a-compiled-deno-script-in-a-github-action">Running a compiled Deno script in a GitHub Action</a></li>
<li><a href="./getting-started-with-deno">Getting Started with Deno</a></li>
<li><a href="./calling-rust-from-a-cloudflare-worker">Calling Rust from a Cloudflare Worker</a></li>
<li><a href="./fun-with-vercel">Fun with Vercel</a></li>
<li><a href="./first-steps-using-cloudflare-pages">First steps using Cloudflare Pages</a></li>
<li><a href="./migrating-from-cjs-to-esm">Migrating from CommonJS to ESM</a></li>
<li><a href="./forays-from-node-to-rust">Forays from Node to Rust</a></li>
<li><a href="./github-actions-101">GitHub Actions 101</a></li>
<li><a href="./a-web-for-everyone">A Web for Everyone</a></li>
<li><a href="./why-serverless-at-the-edge">Why Serverless at the Edge?</a></li>
<li><a href="./spring-boot-101">Spring Boot 101</a></li>
<li><a href="./why-the-web-needs-better-html-editing-components">Why the Web needs better HTML editing components</a></li>
<li><a href="./about">About me</a></li>
</ul>
</nav>
</div>

<div id="title" style='background-image:url("images/rose.jpg");'>
  <div class="title">Preventing concurrent GitHub Actions</div>
  <div class="subtitle"></div>
</div>

<div id="main" onclick="">
<div id="content">

<div data-render-page="/serializing-github-actions-with-workers-durable-objects">
<span class="permalink"><a class="permalink" href="./serializing-github-actions-with-workers-durable-objects" title="Link to this post.">&#xf0c1;</a></span><span class="date">2021-06-13</span>

<div >
<div data-render-html="/serializing-github-actions-with-workers-durable-objects"><h2 id="github-actions-workflows">GitHub Actions Workflows</h2>
<p>What happens when you trigger a <a href="./github-actions-101">GitHub Actions</a> workflow which is already running? Workflows which depend on being run one-at-a-time might fail.</p>
<p>I recently encountered this with a <a href="https://github.com/jldec/cloudflare-pages-test/blob/main/.github/workflows/generate.yaml" target="_blank" rel="noopener">workflow</a> for publishing a static website. This workflow generates HTML files which are pushed to another git repo for publishing by <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>.</p>
<p><img src="./images/fail-generate.png" alt="Screenshot of Github Actions log showing failed git push"></p>
<p>When two workflows try to push to a checked-out repo at the same time, one will fail because it is missing the last commit from the other.</p>
<p> This is just one example where concurrent workflows are problematic. Workflows which <a href="https://github.community/t/serializing-workflow-runs-in-the-context-of-continuous-deployment/17559" target="_blank" rel="noopener">automate</a> <a href="https://github.community/t/how-to-limit-concurrent-workflow-runs/16844" target="_blank" rel="noopener">deployments</a> have the same <a href="https://github.community/t/serializing-queueing-deployment-workflows-aws-re-invent/17152" target="_blank" rel="noopener">problem</a>.</p>
<p>A number of 3rd party <a href="https://github.com/softprops/turnstyle" target="_blank" rel="noopener">solutions</a> exist, but these introduce additional waiting costs or other issues. For one of my projects, I host a lock-service, just to force concurrent workflows to exit quietly, and then auto-trigger re-runs.</p>
<blockquote>
<p>Finally, on April 19, 2021,<br><a href="https://github.blog/changelog/2021-04-19-github-actions-limit-workflow-run-or-job-concurrency/" target="_blank" rel="noopener">this</a> appeared in the GitHub Blog.</p>
</blockquote>
<p><img src="./images/github-actions-concurrency-announcement.png" alt="Screenshot of GitHub Blog from April 19, 2021 announcing the new concurrency key in GitHub Actions"></p>
<p>In the case of using actions to generate a GitHub Pages website, <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#concurrency" target="_blank" rel="noopener">the feature works</a> exactly as required.</p>
<ul>
<li>The first workflow will run to completion.</li>
<li>Subsequent concurrent workflows will either be delayed or cancelled.</li>
<li>In the end only the first and last of the overlapping workflows will be run.</li>
</ul>
<p>And all you need is <a href="https://github.com/jldec/cloudflare-pages-test/blob/main/.github/workflows/generate.yaml#L5-L6" target="_blank" rel="noopener">2 lines of yaml</a>.
This is from the workflow which generates <a href="https://jldec.me/first-steps-using-cloudflare-pages#github-pages" target="_blank" rel="noopener">jldec.uk</a>.</p>
<p><a href="https://github.com/jldec/cloudflare-pages-test/blob/main/.github/workflows/generate.yaml#L5-L6" target="_blank" rel="noopener"><img src="./images/github-actions-concurrency-yaml.png" alt="Screenshot of yaml for GitHub Action with concurrency group"></a></p>
<p>The value of the <code>group</code> can be any string - workflows in the same group are effectively serialized.</p>
<blockquote>
<p>Thank you GitHub!</p>
</blockquote>
</div>
</div>


</div><!--page-->

<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-pubblog" target="_blank" rel="noopener">pub-theme-pubblog</a></p>
</div>

</div>
</div>

</div><!--layout-->

<script>window.pubRef = {"href":"/serializing-github-actions-with-workers-durable-objects","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./js/highlight-9.18.1.min.js" ></script>
<script src="./js/pub-pkg-highlight.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- copyright -->
</body>
</html>
