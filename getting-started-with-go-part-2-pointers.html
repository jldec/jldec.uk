<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta property="og:title" content="Getting started with Go pointers">
<meta property="og:image" content="https://jldec.me/images/ladybug.jpg">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jldec.me/getting-started-with-go-part-2-pointers">
<meta property="og:description" content="My experience as a new user of Go pointers">
<meta name="twitter:site" content="@jldec">
<meta name="twitter:creator" content="@jldec">
<meta name="twitter:title" content="Getting started with Go pointers">
<meta name="twitter:description" content="My experience as a new user of Go pointers">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:widgets:new-embed-design" content="on">
<meta name="twitter:image" content="https://jldec.me/images/ladybug.jpg">
<meta name="twitter:image:alt" content="Ladybug in Cambridge UK">
<meta name="robots" content="noindex, nofollow">
<link rel="canonical" href="https://jldec.me/getting-started-with-go-part-2-pointers">

<!-- html generated by pub-server from markdown /getting-started-with-go-part-2-pointers.md -->

<title>Getting started with Go pointers</title>
<link rel="stylesheet" href="./css/pubblog.css">
<link rel="stylesheet" href="./css/open-sans.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<link rel="stylesheet" href="./css/highlight-9.18.1-github.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout">
<header>
<div id="doctitle"><h1 id="jldecuk"><a href="./">jldec.uk</a></h1>
</div>
<div id="topmenu"><div data-render-html="/#topmenu">&nbsp;</div></div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-2x">&#xf01a;</span></p>

<nav id="toc">
<ul>
<li><strong><a href="./">Home</a></strong></li>
<li><a href="./serializing-github-actions-with-workers-durable-objects">Preventing concurrent GitHub Actions</a></li>
<li><a href="./getting-started-with-go-part-3-goroutines-and-channels">Getting started with Goroutines and channels</a></li>
<li><a href="./getting-started-with-go-part-2-pointers">Getting started with Go pointers</a></li>
<li><a href="./getting-started-with-go">Getting started with Go</a></li>
<li><a href="./extracting-an-esm-module-from-a-deno-script">Extracting an ESM module from a Deno script</a></li>
<li><a href="./running-a-compiled-deno-script-in-a-github-action">Running a compiled Deno script in a GitHub Action</a></li>
<li><a href="./getting-started-with-deno">Getting Started with Deno</a></li>
<li><a href="./calling-rust-from-a-cloudflare-worker">Calling Rust from a Cloudflare Worker</a></li>
<li><a href="./fun-with-vercel">Fun with Vercel</a></li>
<li><a href="./first-steps-using-cloudflare-pages">First steps using Cloudflare Pages</a></li>
<li><a href="./migrating-from-cjs-to-esm">Migrating from CommonJS to ESM</a></li>
<li><a href="./forays-from-node-to-rust">Forays from Node to Rust</a></li>
<li><a href="./github-actions-101">GitHub Actions 101</a></li>
<li><a href="./a-web-for-everyone">A Web for Everyone</a></li>
<li><a href="./why-serverless-at-the-edge">Why Serverless at the Edge?</a></li>
<li><a href="./spring-boot-101">Spring Boot 101</a></li>
<li><a href="./why-the-web-needs-better-html-editing-components">Why the Web needs better HTML editing components</a></li>
<li><a href="./about">About me</a></li>
</ul>
</nav>
</div>

<div id="title" style='background-image:url("images/ladybug.jpg");'>
  <div class="title">Getting started with Go pointers</div>
  <div class="subtitle"></div>
</div>

<div id="main" onclick="">
<div id="content">

<div data-render-page="/getting-started-with-go-part-2-pointers">
<span class="permalink"><a class="permalink" href="./getting-started-with-go-part-2-pointers" title="Link to this post.">&#xf0c1;</a></span><span class="date">2021-04-18</span>

<div >
<div data-render-html="/getting-started-with-go-part-2-pointers"><h2 id="golang">Golang</h2>
<p>This is part 2 of my experience as a new user of Go, focusing on the quirks and gotchas of pointers. For installation, testing, and packages, see <a href="./getting-started-with-go">Getting started with Go</a>.</p>
<p>If you&#39;d like to follow along, and try out out the code in this article, all you need is the Go <a href="https://play.golang.org/p/-UiUJFrloVT" target="_blank" rel="noopener">playground</a> to run the examples.</p>
<h2 id="pointers">Pointers</h2>
<p>The <a href="https://github.com/jldec/shortscale-go/blob/main/shortscale.go" target="_blank" rel="noopener">shortscale</a> package which I covered last time, uses a string <a href="https://pkg.go.dev/strings#Builder" target="_blank" rel="noopener">Builder</a>. Here is the example from the Builder docs.</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;strings&quot;
)

func main() {
    var b strings.Builder
    for i := 3; i &gt;= 1; i-- {
        fmt.Fprintf(&amp;b, &quot;%d...&quot;, i)
    }
    b.WriteString(&quot;ignition&quot;)
    fmt.Println(b.String())
}
</code></pre>
<p>Notice that <code>var b</code> is an instance of the Builder. When you run the code, it will output: <em>3...2...1...ignition</em>.</p>
<h2 id="pointer-receiver-methods-and-interfaces">Pointer receiver methods and interfaces</h2>
<p>The first argument to fmt.Fprintf is <code>&amp;b</code>, a <a href="https://tour.golang.org/moretypes/1" target="_blank" rel="noopener">pointer</a> to b. This is necessary, because <a href="https://pkg.go.dev/fmt#Fprintf" target="_blank" rel="noopener">fmt.Fprintf</a> expects an <a href="https://pkg.go.dev/io#Writer" target="_blank" rel="noopener">io.Writer</a> interface.</p>
<p>The <a href="https://pkg.go.dev/strings#Builder.Write" target="_blank" rel="noopener">Builder.Write</a> method matches the io.Writer interface. Notice the pointer syntax in the method receiver after the <code>func</code> keyword.</p>
<pre><code class="language-go">func (b *Builder) Write(p []byte) (int, error)
</code></pre>
<p>I was tempted to replace <code>Fprintf(&amp;b, ...)</code> with <code>Fprintf(b, ...)</code>, to make it more consistent with the <code>b.WriteString()</code> and <code>b.String()</code> further down, but doing this causes the compiler to complain:</p>
<p><em>&quot;cannot use b (type strings.Builder) as type io.Writer in argument to fmt.Fprintf:
strings.Builder does not implement io.Writer (<strong>Write method has pointer receiver</strong>)&quot;</em></p>
<h2 id="value-vs-pointer-function-arguments">Value vs. pointer function arguments</h2>
<p>What if, instead of depending on the Writer interface, we called our own <code>write()</code> function?</p>
<pre><code class="language-go">func main() {
    var b strings.Builder
    for i := 3; i &gt;= 1; i-- {
        write(b, fmt.Sprintf(&quot;%d...&quot;, i))
    }
    b.WriteString(&quot;ignition&quot;)
    fmt.Println(b.String())
}

func write(b strings.Builder, s string) {
    b.WriteString(s)
}
</code></pre>
<p>Running the code above in the <a href="https://pkg.go.dev/strings#Builder" target="_blank" rel="noopener">example sandbox</a> outputs just the word <em>ignition</em>. </p>
<p>The 3 calls to <code>write(b)</code> do not modify the builder declared at the top.</p>
<p>This makes sense, because passing a struct to a function <a href="https://tour.golang.org/methods/4" target="_blank" rel="noopener">copies</a> the struct value.</p>
<p>To fix this, we have to use a pointer to pass the struct by reference, and we have to invoke the function with <code>write(&amp;b, ...)</code>. This works, but it doesn&#39;t make the code any more consistent.</p>
<pre><code class="language-go">func main() {
    var b strings.Builder
    for i := 3; i &gt;= 1; i-- {
        write(&amp;b, fmt.Sprintf(&quot;%d...&quot;, i))
    }
    b.WriteString(&quot;ignition&quot;)
    fmt.Println(b.String())
}

func write(b *strings.Builder, s string) {
    b.WriteString(s)
}
</code></pre>
<h2 id="why-do-the-method-calls-work">Why do the method calls work?</h2>
<p>Why are we allowed to use <code>b</code> instead of <code>&amp;b</code> in front of <a href="https://pkg.go.dev/strings#Builder.WriteString" target="_blank" rel="noopener">b.WriteString</a> and <a href="https://pkg.go.dev/strings#Builder.String" target="_blank" rel="noopener">b.String</a>? This is explained in <a href="https://tour.golang.org/methods/6" target="_blank" rel="noopener">the tour</a> as well.</p>
<p><em>&quot;...even though v is a value and not a pointer, the method with the pointer receiver is called automatically. That is, as a convenience, Go interprets the statement v.Scale(5) as (&amp;v).Scale(5) since the Scale method has a pointer receiver.&quot;</em></p>
<h2 id="start-with-a-pointer">Start with a pointer</h2>
<p>If all this mixing of values and pointers feels inconsistent, why not start with a pointer from the beginning?</p>
<p>The following code will compile just fine, but can you tell what&#39;s wrong with it?</p>
<pre><code class="language-go">func main() {
    var b *strings.Builder
    for i := 3; i &gt;= 1; i-- {
        fmt.Fprintf(b, &quot;%d...&quot;, i)
    }
    b.WriteString(&quot;ignition&quot;)
    fmt.Println(b.String())
}
</code></pre>
<p>The declaration above results in a nil pointer panic at run time, because b is uninitialized.</p>
<blockquote>
<p><em>panic: runtime error: invalid memory address or nil pointer dereference<br>[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4991c7]</em></p>
</blockquote>
<h2 id="create-the-builder-with-new">Create the Builder with new()</h2>
<p>Here is one way to initialize a pointer so that it references a new Builder.</p>
<pre><code class="language-go">func main() {
    b := new(strings.Builder)
    for i := 3; i &gt;= 1; i-- {
        fmt.Fprintf(b, &quot;%d...&quot;, i)
    }
    b.WriteString(&quot;ignition&quot;)
    fmt.Println(b.String())
}
</code></pre>
<p><code>new(strings.Builder)</code> returns a pointer to a freshly allocated Builder, which we can use for both functions and pointer receiver methods. This is the pattern which I now use in <a href="https://github.com/jldec/shortscale-go/blob/2485be23ef48660d8913b2ac884030220dc82d74/shortscale.go#L17-L24" target="_blank" rel="noopener">shortscale-go</a>.</p>
<p>An alternative, which does the same thing, is the more explicit <a href="https://tour.golang.org/moretypes/5" target="_blank" rel="noopener">struct literal</a> shown below.</p>
<pre><code class="language-go">func main() {
    b := &amp;strings.Builder{}
    ...
</code></pre>
<blockquote>
<p>There&#39;s no avoiding pointers in Go.<br>Learn the quirks and the gotchas today.<br>✨ Keep learning! ✨</p>
</blockquote>
<p><em>To leave a comment<br>please visit <a href="https://dev.to/jldec/getting-started-with-go-part-2-pointers-4a47" target="_blank" rel="noopener">dev.to/jldec</a></em></p>
</div>
</div>


</div><!--page-->

<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-pubblog" target="_blank" rel="noopener">pub-theme-pubblog</a></p>
</div>

</div>
</div>

</div><!--layout-->

<script>window.pubRef = {"href":"/getting-started-with-go-part-2-pointers","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./js/highlight-9.18.1.min.js" ></script>
<script src="./js/pub-pkg-highlight.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- copyright -->
</body>
</html>
