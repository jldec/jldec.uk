<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="robots" content="noindex, nofollow">

<!-- html generated by pub-server from markdown /first-steps-using-cloudflare-pages.md -->

<title>First steps using Cloudflare Pages</title>
<link rel="stylesheet" href="./css/pubblog.css">
<link rel="stylesheet" href="./css/open-sans.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<link rel="stylesheet" href="./css/highlight-9.18.1-github.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout">
<header>
<div id="doctitle"><h1 id="jldecuk"><a href="./">jldec.uk</a></h1>
</div>
<div id="topmenu"><div data-render-html="/#topmenu">&nbsp;</div></div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-2x">&#xf01a;</span></p>

<nav id="toc">
<ul>
<li><strong><a href="./">Home</a></strong></li>
<li><a href="./calling-rust-from-a-cloudflare-worker">Calling Rust from a Cloudflare Worker</a></li>
<li><a href="./fun-with-vercel">Fun with Vercel</a></li>
<li><a href="./first-steps-using-cloudflare-pages">First steps using Cloudflare Pages</a></li>
<li><a href="./migrating-from-cjs-to-esm">Migrating from CommonJS to ESM</a></li>
<li><a href="./forays-from-node-to-rust">Forays from Node to Rust</a></li>
<li><a href="./github-actions-101">GitHub Actions 101</a></li>
<li><a href="./a-web-for-everyone">A Web for Everyone</a></li>
<li><a href="./why-serverless-at-the-edge">Why Serverless at the Edge?</a></li>
<li><a href="./spring-boot-101">Spring Boot 101</a></li>
<li><a href="./why-the-web-needs-better-html-editing-components">Why the Web needs better HTML editing components</a></li>
<li><a href="./about">About me</a></li>
</ul>
</nav>
</div>

<div id="title" style='background-image:url("images/small-clouds.jpg");'>
  <div class="title">First steps using Cloudflare Pages</div>
  <div class="subtitle"></div>
</div>

<div id="main" onclick="">
<div id="content">

<div data-render-page="/first-steps-using-cloudflare-pages">
<span class="permalink"><a class="permalink" href="./first-steps-using-cloudflare-pages" title="Link to this post.">&#xf0c1;</a></span><span class="date">2021-01-31</span>

<div >
<div data-render-html="/first-steps-using-cloudflare-pages"><h2 id="jldecme">jldec.me</h2>
<p>My personal blog, <a href="https://jldec.me" target="_blank" rel="noopener">jldec.me</a>, is hosted on <a href="https://netlify.com" target="_blank" rel="noopener">Netlify</a>. Whenever I push markdown to GitHub, Netlify runs a build and publishes the HTML.</p>
<p>Cloudflare recently <a href="https://blog.cloudflare.com/cloudflare-pages/" target="_blank" rel="noopener">announced</a> a similar offering called <a href="https://pages.cloudflare.com/" target="_blank" rel="noopener">Cloudflare Pages</a>. I was lucky enough to be given access to the Beta.</p>
<p>Unlike <a href="https://www.netlify.com/pricing/#features" target="_blank" rel="noopener">Netlify</a>, Cloudflare Pages <a href="https://pages.cloudflare.com/#pricing" target="_blank" rel="noopener">does not meter</a> request traffic. This opens the door for use-cases like CDN hosting of open source <a href="./migrating-from-cjs-to-esm">ESM modules</a> ü§î.</p>
<h2 id="cloudflare-pages-beta">Cloudflare Pages (Beta)</h2>
<p>This is a walkthrough of setting up <a href="https://jldec.eu" target="_blank" rel="noopener">jldec.eu</a>, a copy of <a href="https://jldec.me" target="_blank" rel="noopener">jldec.me</a>, on Cloudflare Pages.</p>
<p>If you have access to Cloudflare Pages, you will see this button when you login to Cloudflare.</p>
<p><img src="./images/cf-pages-beta.png" alt="Cloudflare Pages Beta button on dashboard"></p>
<p>The Pages button opens your Pages projects -- of which there are none at first -- and a button to <code>Create a project</code>.</p>
<p><img src="./images/cf-pages-create-a-project.png" alt="Pages - Create a project"></p>
<p> This opens the GitHub form for granting repo access to the &#39;Cloudflare Pages&#39; GitHub app. (<em>Look for it later in your <a href="https://github.com/settings/installations" target="_blank" rel="noopener">GitHub Settings</a> to add more repos, or to revoke access.</em>)</p>
<p><img src="./images/cf-pages-github-app.png" alt="Authorize Cloudflare Pages app on GitHub"></p>
<p>Back on Cloudflare, you can choose the repo for your new Cloudflare Pages project.<br><a href="https://github.com/jldec/cloudflare-pages-test" target="_blank" rel="noopener">cloudflare-pages-test</a> is a copy of my markdown source repo from <a href="https://jldec.me" target="_blank" rel="noopener">jldec.me</a>.</p>
<p><img src="./images/cf-pages-select-repo.png" alt="Select repo for the Cloudflare Pages project"></p>
<p>In the configuratiom form, I provided branch name, build command, and output directory.<br>The project name defaults to the repo name.</p>
<p><img src="./images/cf-pages-configure-build.png" alt="Configure the build command and output directory"></p>
<p>Submitting the form, triggers the first build and shows the log.</p>
<p><img src="./images/cf-pages-build-log.png" alt="First build and deploy showing log"></p>
<p>The project page also has a section for configuring custom domains. I used my own cloudflare-hosted domain <a href="https://jldec.eu" target="_blank" rel="noopener">jldec.eu</a>. The <a href="https://developers.cloudflare.com/pages/getting-started#add-a-custom-cname-record" target="_blank" rel="noopener">docs</a> can be a little confusing here. My CNAME points to <code>cloudflare-pages-test.pages.dev</code> not <code>custom.pages.dev</code>.</p>
<p><img src="./images/cf-pages-custom-domain.png" alt="Cloudflare Pages custom domain"></p>
<p>You can visit the deployed site at <a href="https://jldec.eu" target="_blank" rel="noopener">jldec.eu</a>. üá™üá∫<br>Subsequent commits to this GitHub <a href="https://github.com/jldec/cloudflare-pages-test" target="_blank" rel="noopener">repo</a> will trigger a fresh build and re-deploy.</p>
<p><img src="./images/cf-pages-deployments.png" alt="More deployments"></p>
<h2 id="github-pages">GitHub Pages</h2>
<p>For comparison, I set up <a href="https://jldec.uk" target="_blank" rel="noopener">jldec.uk</a>, another copy of <a href="https://jldec.me" target="_blank" rel="noopener">jldec.me</a> using <a href="https://pages.github.com" target="_blank" rel="noopener">GitHub Pages</a>.</p>
<p>First I created a new jldec.uk <a href="https://github.com/jldec/jldec.uk/" target="_blank" rel="noopener">repo</a> to host the GitHub Pages site. Since the output includes javascript bundles, fonts, etc., I prefer to keep it separate from the source.</p>
<p>I pushed the first generated website to this repo manually, using the output of a local build. The empty <code>.nojekyll</code> file is important to avoid a Jekyll build on GitHub.</p>
<p><img src="./images/gh-pages-repo.png" alt="GitHub Pages repo"></p>
<p>Next I configured GitHub Pages in the repo settings (<a href="https://github.blog/2016-08-17-simpler-github-pages-publishing/" target="_blank" rel="noopener">...looks familiar üòÉ</a>)</p>
<p><img src="./images/gh-pages-settings.png" alt="GitHub Pages settings"></p>
<p>You can visit the deployed site at <a href="https://jldec.uk" target="_blank" rel="noopener">jldec.uk</a>. üá¨üáß  </p>
<p>Finally I set up <a href="https://github.com/jldec/cloudflare-pages-test/blob/main/.github/workflows/generate.yaml" target="_blank" rel="noopener">GitHub Actions</a> to auto-build and auto-deploy the website when the source changes. This is triggered on push, does a checkout of both repos, and commits the new generated output, only when there are actual changes.</p>
<pre><code class="language-yaml">on:
  push:
    branches: [ main ]
  workflow_dispatch:
jobs:
  generate:
    runs-on: ubuntu-latest
    env:
      JLDEC_UK: TRUE

    steps:
    - name: checkout source repo
      uses: actions/checkout@v2

    - name: checkout destination repo under ./out
      uses: actions/checkout@v2
      with:
        repository: jldec/jldec.uk
        token: ${{ secrets.GH_TOKEN }}
        path: out

    - name: generate output
      run: |
        npm ci
        rm -r out/*
        npm run generate
        cd out
        git config user.email &quot;jldec@ciaosoft.com&quot;
        git config user.name &quot;cloudflare-pages-test generate action&quot;
        git status
        git add -A
        if ! git diff-index --quiet HEAD ; then git commit -m &#39;https://github.com/jldec/cloudflare-pages-test/actions/runs/${{ github.run_id }}&#39; &amp;&amp; git push ; fi
        echo done
</code></pre>
<p>Now every push triggers a new build and re-deploy.</p>
<p><img src="./images/gh-pages-builds.png" alt="GitHub Pages builds using GitHub Actions"></p>
<p>Preserving the HTML site in git is useful for all kinds of reasons. E.g. here is part of a diff from a recent <a href="https://github.com/jldec/jldec.uk/commit/0efb3e73ea2de797f9201b69803c70299be05a28" target="_blank" rel="noopener">commit</a>.</p>
<p><img src="./images/gh-pages-diff.png" alt="GitHub Pages diff"></p>
<h2 id="conclusions">Conclusions</h2>
<p>The developer experience of hosting a site with CloudFlare Pages is very similar to Netlify.</p>
<p>The Cloudflare Pages Beta does not yet support redirects and functions, but those are expected with the integration of <a href="https://workers.cloudflare.com" target="_blank" rel="noopener">Cloudflare Workers</a>.</p>
<p>Automating builds and deploys onto GitHub Pages is more work, and requires knowledge of GitHub Actions if you&#39;re not using Jekyll. There are other gotchas with GitHub Actions if you want to support concurrent builds or preview builds.</p>
<blockquote>
<p>The performance of all 3 platforms is excellent since they all serve static files from a CDN<br>üèÉ‚Äç‚ôÄÔ∏è</p>
</blockquote>
<p><em>To leave a comment<br>please visit <a href="https://dev.to/jldec/first-steps-using-cloudflare-pages-40gp" target="_blank" rel="noopener">dev.to/jldec</a></em></p>
</div>
</div>


</div><!--page-->

<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-pubblog" target="_blank" rel="noopener">pub-theme-pubblog</a></p>
</div>

</div>
</div>

</div><!--layout-->

<script>window.pubRef = {"href":"/first-steps-using-cloudflare-pages","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./js/highlight-9.18.1.min.js" ></script>
<script src="./js/pub-pkg-highlight.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- copyright -->
</body>
</html>
