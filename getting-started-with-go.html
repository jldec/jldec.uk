<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta property="og:title" content="Getting started with Go">
<meta property="og:image" content="https://jldec.me/images/church-blossoms.jpg">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jldec.me/getting-started-with-go">
<meta property="og:description" content="My experience as a new user of Go, building my first Go library">
<meta name="twitter:site" content="@jldec">
<meta name="twitter:creator" content="@jldec">
<meta name="twitter:title" content="Getting started with Go">
<meta name="twitter:description" content="My experience as a new user of Go, building my first Go library">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:widgets:new-embed-design" content="on">
<meta name="twitter:image" content="https://jldec.me/images/church-blossoms.jpg">
<meta name="twitter:image:alt" content="Blossoms in Cambridge UK">
<meta name="robots" content="noindex, nofollow">
<link rel="canonical" href="https://jldec.me/getting-started-with-go">

<!-- html generated by pub-server from markdown /getting-started-with-go.md -->

<title>Getting started with Go</title>
<link rel="stylesheet" href="./css/pubblog.css">
<link rel="stylesheet" href="./css/open-sans.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<link rel="stylesheet" href="./css/highlight-9.18.1-github.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout">
<header>
<div id="doctitle"><h1 id="jldecuk"><a href="./">jldec.uk</a></h1>
</div>
<div id="topmenu"><div data-render-html="/#topmenu">&nbsp;</div></div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-2x">&#xf01a;</span></p>

<nav id="toc">
<ul>
<li><strong><a href="./">Home</a></strong></li>
<li><a href="./serializing-github-actions-with-workers-durable-objects">Preventing concurrent GitHub Actions</a></li>
<li><a href="./getting-started-with-go-part-3-goroutines-and-channels">Getting started with Goroutines and channels</a></li>
<li><a href="./getting-started-with-go-part-2-pointers">Getting started with Go pointers</a></li>
<li><a href="./getting-started-with-go">Getting started with Go</a></li>
<li><a href="./extracting-an-esm-module-from-a-deno-script">Extracting an ESM module from a Deno script</a></li>
<li><a href="./running-a-compiled-deno-script-in-a-github-action">Running a compiled Deno script in a GitHub Action</a></li>
<li><a href="./getting-started-with-deno">Getting Started with Deno</a></li>
<li><a href="./calling-rust-from-a-cloudflare-worker">Calling Rust from a Cloudflare Worker</a></li>
<li><a href="./fun-with-vercel">Fun with Vercel</a></li>
<li><a href="./first-steps-using-cloudflare-pages">First steps using Cloudflare Pages</a></li>
<li><a href="./migrating-from-cjs-to-esm">Migrating from CommonJS to ESM</a></li>
<li><a href="./forays-from-node-to-rust">Forays from Node to Rust</a></li>
<li><a href="./github-actions-101">GitHub Actions 101</a></li>
<li><a href="./a-web-for-everyone">A Web for Everyone</a></li>
<li><a href="./why-serverless-at-the-edge">Why Serverless at the Edge?</a></li>
<li><a href="./spring-boot-101">Spring Boot 101</a></li>
<li><a href="./why-the-web-needs-better-html-editing-components">Why the Web needs better HTML editing components</a></li>
<li><a href="./about">About me</a></li>
</ul>
</nav>
</div>

<div id="title" style='background-image:url("images/church-blossoms.jpg");'>
  <div class="title">Getting started with Go</div>
  <div class="subtitle"></div>
</div>

<div id="main" onclick="">
<div id="content">

<div data-render-page="/getting-started-with-go">
<span class="permalink"><a class="permalink" href="./getting-started-with-go" title="Link to this post.">&#xf0c1;</a></span><span class="date">2021-04-03</span>

<div >
<div data-render-html="/getting-started-with-go"><h2 id="golang">Golang</h2>
<p>The <a href="https://go.dev/" target="_blank" rel="noopener">Go</a> programming language has become an important tool for developers, particularly around platforms like Kubernetes and Docker.</p>
<p>Go was created at Google by a team whose roots go back to Bell Labs and <a href="https://en.wikipedia.org/wiki/C_(programming_language)" target="_blank" rel="noopener">C</a>. Their <a href="https://talks.golang.org/2012/splash.article" target="_blank" rel="noopener">motivations</a> included fast compilation time, and productive development of large scale distributed systems, handling high volumes of concurrent requests.</p>
<p>This article describes my experience as a new user of Go, building my first Go library. It follows a learning pattern similar to <a href="./forays-from-node-to-rust">forays from Node to Rust</a>.</p>
<h2 id="getting-started">Getting started</h2>
<p>The <a href="https://tour.golang.org/basics/1" target="_blank" rel="noopener">Tour of Go</a> is a great way to get familiar with the language syntax. I started with &#39;hello world&#39; at <a href="https://golang.org/doc/tutorial/getting-started#install" target="_blank" rel="noopener">golang.org</a>, and found myself going back to the tour for different topics.</p>
<p><a href="https://tour.golang.org/basics/1" target="_blank" rel="noopener"><img src="./images/go-tour.png" alt="Screenshot of the Go Tour showing code and navigation" class="no-border"></a></p>
<p>The macOS <a href="https://golang.org/doc/manage-install" target="_blank" rel="noopener">installer</a> copies everything into <code>/usr/local/go</code>, so I opted to download the latest release from <a href="https://golang.org/dl/" target="_blank" rel="noopener">https://golang.org/dl/</a> into a versioned <a href="https://golang.org/doc/install/source#environment" target="_blank" rel="noopener">$GOROOT</a> under my home directory. Here&#39;s what I have in my &#39;.bash_profile&#39;:</p>
<pre><code class="language-sh">export GOPATH=~/go
export GOROOT=~/go1.16.3
export PATH=${PATH}:${GOROOT}/bin:${GOPATH}/bin
</code></pre>
<h2 id="vs-code">VS Code</h2>
<p>The <a href="https://github.com/golang/vscode-go/" target="_blank" rel="noopener">VS Code Go</a> extension has improved a lot over the years. It now auto-installs the <a href="https://github.com/go-delve/delve" target="_blank" rel="noopener">delve</a> debugger, and the <a href="https://blog.golang.org/gopls-vscode-go" target="_blank" rel="noopener">gopls</a> language server. I did not have to do any additional configuration.</p>
<p>Hovering over types like <code>Builder</code> shows source docs, and links to <a href="https://go.dev" target="_blank" rel="noopener">pkg.go.dev</a>.</p>
<p><img src="./images/go-vs-code.png" alt="VS Code screenshot showing hover over strings.Builder"></p>
<h2 id="porting-from-rust-to-go">Porting from Rust to Go</h2>
<p>I found it quite easy to port <a href="https://github.com/jldec/shortscale-rs/blob/main/src/shortscale.rs#L15" target="_blank" rel="noopener">shortscale-rs</a> to <a href="https://github.com/jldec/shortscale-go/blob/main/shortscale.go" target="_blank" rel="noopener">shortscale-go</a>.</p>
<p>Go has no ownership syntax, and the run-time includes a garbage collector.</p>
<p>In this case, I was also lucky that the Go <a href="https://pkg.go.dev/strings#Builder" target="_blank" rel="noopener">strings.Builder</a> standard library package is very similar to the <a href="https://github.com/jldec/shortscale-rs/blob/main/src/shortscale.rs#L46" target="_blank" rel="noopener">writer</a> pattern I ended up using for Rust.</p>
<blockquote>
<p>Overall, I was pleasantly surprised with the readability of the code</p>
</blockquote>
<pre><code class="language-go">package shortscale

import (
    &quot;strings&quot;
)

// Shortscale converts numbers into English words.
// Supports positive integers from 0 to 999_999_999_999_999_999.
// Larger values return &quot;(big number)&quot;.
func Shortscale(n uint64) string {
    if n &lt;= 20 {
        return numwords[n]
    }
    if n &gt; 999_999_999_999_999_999 {
        return &quot;(big number)&quot;
    }
    b := new(strings.Builder)
    writeScale(b, n, 1_000_000_000_000_000) // quadrillions
    writeScale(b, n, 1_000_000_000_000)     // trillions
    writeScale(b, n, 1_000_000_000)         // billions
    writeScale(b, n, 1_000_000)             // millions
    writeScale(b, n, 1_000)                 // thousands
    writeHundreds(b, n)
    writeTensAndUnits(b, n, b.Len() &gt; 0)
    return b.String()
}

func writeTensAndUnits(b *strings.Builder, n uint64, ifAnd bool) {
    n = n % 100
    if n == 0 {
        return
    }
    if ifAnd {
        writeWord(b, &quot;and&quot;)
    }
    if n &lt;= 20 {
        writeWord(b, numwords[n])
        return
    }
    writeWord(b, numwords[n/10*10]) // tens
    units := n % 10
    if units &gt; 0 {
        writeWord(b, numwords[units])
    }
}

func writeHundreds(b *strings.Builder, n uint64) {
    n = n / 100 % 10
    if n == 0 {
        return
    }
    writeWord(b, numwords[n])
    writeWord(b, numwords[100])
}

func writeScale(b *strings.Builder, n uint64, thousands uint64) {
    n = n / thousands % 1_000
    if n == 0 {
        return
    }
    writeHundreds(b, n)
    writeTensAndUnits(b, n, (n/100%10) &gt; 0)
    writeWord(b, numwords[thousands])
}

func writeWord(b *strings.Builder, word string) {
    if b.Len() &gt; 0 {
        b.WriteString(&quot; &quot;)
    }
    b.WriteString(word)
}

var numwords = map[uint64]string{
    0:                     &quot;zero&quot;,
    1:                     &quot;one&quot;,
    2:                     &quot;two&quot;,
    3:                     &quot;three&quot;,
    4:                     &quot;four&quot;,
    5:                     &quot;five&quot;,
    6:                     &quot;six&quot;,
    7:                     &quot;seven&quot;,
    8:                     &quot;eight&quot;,
    9:                     &quot;nine&quot;,
    10:                    &quot;ten&quot;,
    11:                    &quot;eleven&quot;,
    12:                    &quot;twelve&quot;,
    13:                    &quot;thirteen&quot;,
    14:                    &quot;fourteen&quot;,
    15:                    &quot;fifteen&quot;,
    16:                    &quot;sixteen&quot;,
    17:                    &quot;seventeen&quot;,
    18:                    &quot;eighteen&quot;,
    19:                    &quot;nineteen&quot;,
    20:                    &quot;twenty&quot;,
    30:                    &quot;thirty&quot;,
    40:                    &quot;forty&quot;,
    50:                    &quot;fifty&quot;,
    60:                    &quot;sixty&quot;,
    70:                    &quot;seventy&quot;,
    80:                    &quot;eighty&quot;,
    90:                    &quot;ninety&quot;,
    100:                   &quot;hundred&quot;,
    1_000:                 &quot;thousand&quot;,
    1_000_000:             &quot;million&quot;,
    1_000_000_000:         &quot;billion&quot;,
    1_000_000_000_000:     &quot;trillion&quot;,
    1_000_000_000_000_000: &quot;quadrillion&quot;,
}
</code></pre>
<h2 id="tests-and-benchmarks">Tests and benchmarks</h2>
<p>The <a href="https://pkg.go.dev/testing" target="_blank" rel="noopener">testing</a> package provides support for running tests and benchmarks with <code>go test</code>. The GitHub Action <a href="https://github.com/jldec/shortscale-go/blob/main/.github/workflows/ci.yaml#L25" target="_blank" rel="noopener">workflow</a> for shortscale-go make use of this.</p>
<p>Out of curiosity, I ran <a href="https://github.com/jldec/shortscale-go/blob/main/shortscale_test.go#L24" target="_blank" rel="noopener">BenchmarkShortscale</a> for two variants of the Shortscale function, one which <a href="https://github.com/jldec/shortscale-go/blob/358a49f24dcb9d4b2c697233f37f5dea4c87d318/shortscale.go#L18" target="_blank" rel="noopener">pre-allocates</a> memory for string.Builder, and one which does not. Pre-allocating, reduced the number of allocs/op from 4 to 1, improving ns/op by about 85ns.</p>
<p><strong>Pre-allocated</strong></p>
<pre><code>$ go test -bench . -benchmem
goos: darwin
goarch: amd64
pkg: github.com/jldec/shortscale-go
cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz

5694252           205.5 ns/op          64 B/op           1 allocs/op
</code></pre>
<p><strong>Not pre-allocated</strong></p>
<pre><code>$ go test -bench . -benchmem
goos: darwin
goarch: amd64
pkg: github.com/jldec/shortscale-go
cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz

4100697           292.9 ns/op         120 B/op           4 allocs/op
</code></pre>
<h2 id="dependency-management">Dependency management</h2>
<p>Until quite recently, Go <a href="https://research.swtch.com/vgo-intro#versioning_and_api_stability" target="_blank" rel="noopener">did not have</a> built-in package versioning like <a href="./migrating-from-cjs-to-esm">npm</a> or <a href="./forays-from-node-to-rust">cargo</a>. This led to incompatibile versioning add-ons, like <a href="https://github.com/tools/godep" target="_blank" rel="noopener">godep</a> and <a href="https://github.com/Masterminds/glide" target="_blank" rel="noopener">glide</a>, which made packages with nested dependencies difficult to consume. E.g. see this old <a href="https://github.com/kubernetes/client-go/blob/416948da08dfd61cd4a08a3d679865ce91ff39b6/INSTALL.md#dependency-management-for-the-serious-or-reluctant-user" target="_blank" rel="noopener">INSTALL.md</a> from kubernetes/client-go.</p>
<blockquote>
<p>Fortunately, <a href="https://blog.golang.org/using-go-modules" target="_blank" rel="noopener">Go modules</a> are enabled as the default in Go since <a href="https://blog.golang.org/go116-module-changes" target="_blank" rel="noopener">v1.16</a>.</p>
</blockquote>
<h2 id="gomod">go.mod</h2>
<p>I created my <a href="https://github.com/jldec/shortscale-go/blob/main/go.mod" target="_blank" rel="noopener">shortscale-go</a> module with <a href="https://golang.org/pkg/cmd/go/#hdr-Module_maintenance" target="_blank" rel="noopener">go mod init</a> following the guide in <a href="https://blog.golang.org/using-go-modules" target="_blank" rel="noopener">Using Go Modules</a>.</p>
<pre><code class="language-sh">$ go mod init github.com/jldec/shortscale-go
go: creating new go.mod: module github.com/jldec/shortscale-go
</code></pre>
<p>This created a new <strong>go.mod</strong> file with the following content.</p>
<pre><code class="language-js">module github.com/jldec/shortscale-go

go 1.16
</code></pre>
<p>I was a little surprised that there was no way to indicate the module version inside <code>go.mod</code>. Go <a href="https://blog.golang.org/publishing-go-modules" target="_blank" rel="noopener">relies on git tags</a> in the form vx.x.x for this. As I pushed each version to GitHub, I used the GitHub <a href="https://github.com/jldec/shortscale-go/releases" target="_blank" rel="noopener">Releases</a> UI to create the tag.</p>
<h2 id="pkggodev">pkg.go.dev</h2>
<p>The shortscale package is published at <a href="https://pkg.go.dev/github.com/jldec/shortscale-go" target="_blank" rel="noopener">https://pkg.go.dev/github.com/jldec/shortscale-go</a></p>
<p><a href="https://pkg.go.dev/github.com/jldec/shortscale-go" target="_blank" rel="noopener"><img src="./images/shortscale-go-go-dev.png" alt="Module page for shortscale-go on go.dev"></a></p>
<p>It turns out that fetching any versioned module with <code>go get</code>, automatically adds that module to the registry at <a href="https://go.dev/about" target="_blank" rel="noopener">go.dev</a>. This feels a little strange at first, but the more I use it, the more I think it&#39;s a clever solution.</p>
<blockquote>
<p>How about using a similar scheme to create a vendor-neutral registry for <a href="./extracting-an-esm-module-from-a-deno-script">ESM modules</a>?<br>🤔</p>
</blockquote>
<p><em>To leave a comment<br>please visit <a href="https://dev.to/jldec/getting-started-with-go-2m9e" target="_blank" rel="noopener">dev.to/jldec</a></em></p>
</div>
</div>


</div><!--page-->

<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-pubblog" target="_blank" rel="noopener">pub-theme-pubblog</a></p>
</div>

</div>
</div>

</div><!--layout-->

<script>window.pubRef = {"href":"/getting-started-with-go","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./js/highlight-9.18.1.min.js" ></script>
<script src="./js/pub-pkg-highlight.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- copyright -->
</body>
</html>
